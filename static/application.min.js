var haste_document=function(){this.locked=!1};haste_document.prototype.load=function(a,b,c){var d=this;$.ajax("/documents/"+a,{type:"get",dataType:"json",success:function(e){d.locked=!0,d.key=a,d.data=e.data;try{var f=c?hljs.highlight(c,e.data):hljs.highlightAuto(e.data)}catch(g){f=hljs.highlightAuto(e.data)}b({value:f.value,key:a,language:f.language||c})},error:function(a){b(!1)}})},haste_document.prototype.save=function(a,b){if(this.locked)return!1;this.data=a;var c=this;$.ajax("/documents",{type:"post",data:a,dataType:"json",success:function(d){c.locked=!0,c.key=d.key;var e=hljs.highlightAuto(a);b({value:e.value,key:d.key,language:e.language})}})};var haste=function(a,b){this.appName=a,this.baseUrl=window.location.href,this.$textarea=$("textarea"),this.$box=$("#box"),this.$code=$("#box code"),this.options=b,this.configureShortcuts(),this.configureButtons(),b.twitter||$("#key .box2 .twitter").hide()};haste.prototype.setTitle=function(a){var b=a?this.appName+" - "+a:this.appName;document.title=b},haste.prototype.lightKey=function(){this.configureKey(["new","save"]),this.removeClip()},haste.prototype.fullKey=function(){this.configureKey(["new","duplicate","twitter","link"]),this.configureClip()},haste.prototype.configureKey=function(a){var b,c=0;$("#key .box2 .function").each(function(){b=$(this);for(c=0;c<a.length;c++)if(b.hasClass(a[c]))return b.addClass("enabled"),!0;b.removeClass("enabled")})},haste.prototype.newDocument=function(a){this.$box.hide(),this.doc=new haste_document,a||window.history.pushState(null,this.appName,"/"),this.setTitle(),this.lightKey(),this.$textarea.val("").show("fast",function(){this.focus()})},haste.extensionMap={rb:"ruby",py:"python",pl:"perl",php:"php",scala:"scala",go:"go",xml:"xml",html:"xml",htm:"xml",css:"css",js:"javascript",vbs:"vbscript",lua:"lua",pas:"delphi",java:"java",cpp:"cpp",cc:"cpp",m:"objectivec",vala:"vala",cs:"cs",sql:"sql",sm:"smalltalk",lisp:"lisp",ini:"ini",diff:"diff",bash:"bash",sh:"bash",tex:"tex",erl:"erlang",hs:"haskell",md:"markdown"},haste.prototype.lookupExtension=function(a){var b=haste.extensionMap[a];return b},haste.prototype.loadDocument=function(a){var b=a.split(".",2),c=this;c.doc=new haste_document,c.doc.load(b[0],function(a){if(a){c.$code.html(a.value);var b=a.key;a.language&&(b+=" - "+a.language),c.setTitle(b),c.fullKey(),c.$textarea.val("").hide(),c.$box.show().focus()}else c.newDocument()},this.lookupExtension(b[1]))},haste.prototype.duplicateDocument=function(){if(this.doc.locked){var a=this.doc.data;this.newDocument(),this.$textarea.val(a)}},haste.prototype.lockDocument=function(){var a=this;this.doc.save(this.$textarea.val(),function(b){if(b){a.$code.html(b.value);var c=b.key;b.language&&(c+=" - "+b.language),a.setTitle(c),window.history.pushState(null,a.appName+"-"+b.key,"/"+b.key),a.fullKey(),a.$textarea.val("").hide(),a.$box.show().focus()}})},haste.prototype.configureClip=function(){var a=this.clipper=new ZeroClipboard.Client;this.clipper.setHandCursor(!0),this.clipper.setCSSEffects(!1),this.clipper.setText(window.location.href),$("#key .box2 .link").html(this.clipper.getHTML(32,37))},haste.prototype.removeClip=function(){this.clipper&&this.clipper.destroy(),$("#key .box2 .link").html("")},haste.prototype.configureButtons=function(){var a=this;this.buttons=[{$where:$("#key .box2 .save"),label:"Save",shortcutDescription:"control + s",shortcut:function(a){return a.ctrlKey&&(a.keyCode===76||a.keyCode===83)},action:function(){a.$textarea.val().replace(/^\s+|\s+$/g,"")!==""&&a.lockDocument()}},{$where:$("#key .box2 .new"),label:"New",shortcut:function(a){return a.ctrlKey&&a.keyCode===78},shortcutDescription:"control + n",action:function(){a.newDocument(!a.doc.key)}},{$where:$("#key .box2 .duplicate"),label:"Duplicate & Edit",shortcut:function(b){return a.doc.locked&&b.ctrlKey&&b.keyCode===68},shortcutDescription:"control + d",action:function(){a.duplicateDocument()}},{$where:$("#key .box2 .twitter"),label:"Twitter",shortcut:function(b){return a.options.twitter&&a.doc.locked&&b.ctrlKey&&b.keyCode==84},shortcutDescription:"control + t",action:function(){window.open("https://twitter.com/share?url="+encodeURI(a.baseUrl+a.doc.key))}},{$where:$("#key .box2 .link"),label:"Copy URL",letBubble:!0,action:function(){}}];for(var b=0;b<this.buttons.length;b++)this.configureButton(this.buttons[b])},haste.prototype.configureButton=function(a){a.$where.click(function(b){b.preventDefault(),$(this).hasClass("enabled")&&a.action()}),a.$where.mouseenter(function(b){$("#key .box3 .label").text(a.label),$("#key .box3 .shortcut").text(a.shortcutDescription||""),$("#key .box3").show()}),a.$where.mouseleave(function(a){$("#key .box3").hide()})},haste.prototype.configureShortcuts=function(){var a=this;$(document.body).keydown(function(b){var c;for(var d=0;d<a.buttons.length;d++){c=a.buttons[d];if(c.shortcut&&c.shortcut(b)){c.letBubble||b.preventDefault(),c.action();return}}})},$(function(){$("textarea").keydown(function(a){if(a.keyCode===9){a.preventDefault();var b="  ";if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=b,this.focus();else if(this.selectionStart||this.selectionStart=="0"){var c=this.selectionStart,d=this.selectionEnd,e=this.scrollTop;this.value=this.value.substring(0,c)+b+this.value.substring(d,this.value.length),this.focus(),this.selectionStart=c+b.length,this.selectionEnd=c+b.length,this.scrollTop=e}else this.value+=b,this.focus()}})})